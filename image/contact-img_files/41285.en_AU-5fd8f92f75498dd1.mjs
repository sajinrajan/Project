"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[41285],{924633:(e,t,a)=>{var n,r;a.r(t),a.d(t,{default:()=>l});let i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"OneTapSavePinWrapperQuery_pin",selections:[{alias:null,args:null,kind:"ScalarField",name:"entityId",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"storyPinDataId",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"trackingParams",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"title",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"link",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isPromoted",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"promotedIsRemovable",storageKey:null},{alias:null,args:null,concreteType:"Board",kind:"LinkedField",name:"board",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"layout",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"pinner",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null}],storageKey:null},{alias:"imageSpec_236x",args:[{kind:"Literal",name:"spec",value:"236x"}],concreteType:"ImageDetails",kind:"LinkedField",name:"images",plural:!1,selections:[r],storageKey:'images(spec:"236x")'},{kind:"InlineDataFragmentSpread",name:"getPinTrackingParamsMap_pin",selections:[{kind:"ClientExtension",selections:[{alias:null,args:null,concreteType:"TrackingParamsMap",kind:"LinkedField",name:"trackingParamsMap",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"data",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null}],storageKey:null}]}],args:null,argumentDefinitions:[]},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"__id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"imageBase64",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mediaUploadId",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"imageUrl",storageKey:null},{alias:null,args:null,concreteType:"SaveTarget",kind:"LinkedField",name:"savedInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"localPinId",storageKey:null},n],storageKey:null}]}],type:"Pin",abstractKey:null};i.hash="2379d046056df46feae5d51bdf95a4d1";let l=i},750441:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});let n={kind:"InlineDataFragment",name:"getPinTrackingParamsMap_pin"};n.hash="57357f2b0e006ba81b2f258ce3430e30";let r=n},190971:(e,t,a)=>{a.d(t,{c:()=>p});var n=a(667294),r=a(616550),i=a(179370),l=a(96157),s=a(624797),o=a(554786);let d=(e,t)=>((0,l.XU)(e)&&e.state?.from&&(e=e.state.from),(0,l.HV)(e))?t?1000503:1000558:(0,l.En)(e)?t?1000506:1000559:(0,l.L6)(e)?t?1000141:1000494:void 0,u=(e,t)=>{if(t&&(0,l.L6)(e))return 1000564},c=(e,t)=>{if(t){if((0,l.HV)(e))return 1000541;if((0,l.En)(e))return 1000542;if((0,l.L6)(e))return 1000140}else if((0,l.HV)(e))return 1000544;else if((0,l.En)(e))return 1000543;else if((0,l.L6)(e))return 1000540},p=()=>{let{mountPlacement:e,registerdAfterActionPlacements:t}=(0,i.M)(),a=(0,o.HG)(),p=(0,r.TH)(),m=(0,n.useCallback)((n,r,i)=>{let o;switch(n){case"Save":o=d(p,a);break;case"Download":(0,l.L6)(p)&&(o=a?1000499:1000500);break;case"Clickthrough":o=c(p,a);break;case"NoAction":o=u(p,a)}null!=o&&((0,l.En)(p)&&(r={...r,search_query:(0,s.mB)(p.search)}),null!=o&&(t[o]||(0,l.XU)(p))&&e(o,r,i))},[t,e,p,a]);return m}},259743:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(422578),r=a(244311),i=a(288088);let l=function(e,t){let a=t[i.G];if(a){let t=(0,r.getInlineDataFragment)(e).name;return a[t]}return(0,n.readInlineData)(e,t)}},43665:(e,t,a)=>{a.d(t,{Z:()=>n});function n(e){let t=!1,a=new Promise((a,n)=>{e.then(e=>t?n({isCanceled:!0}):a(e),e=>t?n({isCanceled:!0}):n(e))});return{promise:a,cancel(){t=!0}}}},456299:(e,t,a)=>{a.d(t,{Z:()=>l}),a(167912);var n,r=a(259743);let i=void 0!==n?n:n=a(750441),l=e=>{let t=(0,r.Z)(i,e),a=null;return t?.trackingParamsMap&&(a=t.trackingParamsMap.reduce((e,t)=>t?.key?{...e,[t.key]:t.data??""}:e,{})),a}},498301:(e,t,a)=>{a.d(t,{Z:()=>n});function n(e,t){if(!t)return e;let a=new RegExp(/http(s?):/);if(!a.test(e)){let n=a.exec(t);if(n&&n.length){let t=n[0];e=t+e}}return e}},825765:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(667294),r=a(43665);function i(){let e=(0,n.useRef)([]),t=(0,n.useRef)({});return(0,n.useEffect)(()=>()=>{[...Object.keys(t.current).map(e=>t.current[e]),...e.current].forEach(e=>e())},[]),function(a,n){if(n){let e=t.current[n];e&&(e(),delete t.current[n])}let{cancel:i,promise:l}=(0,r.Z)(a);return n?t.current[n]=i:e.current=[...e.current,i],l}}},692440:(e,t,a)=>{a.d(t,{H:()=>d,N:()=>o});var n=a(667294),r=a(342513),i=a(638747),l=a(785893);let{Provider:s,useHook:o}=(0,r.Z)("LastSavedTo");function d({children:e}){let[t,a]=(0,n.useState)();(0,i.Z8)("BoardPickerBoardsShortlistResource",e=>{if(!t){let{data:t}=e.response.resource_response;a(t)}});let r=(0,n.useCallback)(e=>{let n=t?t.filter(t=>t.id!==e.id):[];a([e,...n])},[t]),o=(0,n.useMemo)(()=>({lastSavedTo:t,saveToBoard:r}),[t,r]);return(0,l.jsx)(s,{value:o,children:e})}},86173:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(616550),r=a(96157);function i({hasPin:e,pinId:t,boardLayout:a,boardUrl:i}){let l=(0,n.TH)(),s=(0,n.UO)(),o=(0,n.k6)();return()=>{if(e&&(0,r.L6)(l)&&s.id===t){let e="quick_saves"===a||"quick_creates"===a?"/me/":i??"/";o.replace(e)}}}},767518:(e,t,a)=>{function n(e){return{type:"PIN_BETTER_SAVE",payload:e}}function r(e){return{type:"PIN_BETTER_SAVE_CUTOUT",payload:e}}function i(e){return{type:"PIN_BETTER_UNSAVE",payload:e}}function l(e){return{type:"PIN_BETTER_UNSAVE_CUTOUT",payload:e}}function s(e){return{type:"PIN_BETTER_SELECT_BOARD_OR_SECTION",payload:e}}function o(e){return{type:"PIN_BETTER_SELECT_BOARD_CUTOUT",payload:e}}function d(e){return{type:"POST_REPIN_MORE_IDEAS_UPSELL_SHOWN",payload:{boardId:e}}}a.d(t,{ND:()=>d,Vp:()=>s,a1:()=>n,b6:()=>o,jg:()=>i,o4:()=>r,ti:()=>l})},386129:(e,t,a)=>{a.d(t,{Ge:()=>d,JS:()=>l,OF:()=>k,P_:()=>s,Q_:()=>p,b8:()=>m,eR:()=>v,h2:()=>u,h6:()=>c});var n=a(216167),r=a(107366),i=a(666698);function l(e){return{type:"UPDATE_USER_PIN_COUNT",payload:e}}let s=(e,t)=>({type:"USER_FOLLOW",payload:{id:e,value:t}}),o=(e,t)=>({type:"USER_BLOCK",payload:{id:e,value:t}}),d=({id:e,orbacSubjectId:t,blockSource:a,blockContext:r,logContextEvent:i})=>async l=>{l(o(e,!0));let s=await n.Z.create("UserBlockResource",{blocked_user_id:e,orbac_subject_id:t,block_source:a,block_context:r}).callCreate().catch(()=>l(o(e,!1)));return i({event_type:54,object_id_str:e}),s},u=(e,t)=>async a=>{a(o(e,!1));let r=await n.Z.create("UserBlockResource",{blocked_user_id:e}).callDelete().catch(()=>a(o(e,!0)));return t({event_type:55,object_id_str:e}),r};function c(e){return{type:"UPDATE_USER_SCHEDULED_PIN_COUNT",payload:e}}let p=(e,t)=>()=>{let a=n.Z.create("UserStateResource",{state:e,value:t});return a.callCreate()},m=(e,t,a)=>(n,l)=>{(0,r.Z)({url:"/v3/users/me/",method:"POST"}).then(()=>{a({event_type:48,object_id_str:l().session.userId}),e(),(0,i.Dm)()},t)},g=e=>e>=200&&e<400,_=(e,t="150x150")=>e&&`https://i.pinimg.com/${t}/${e.substring(0,2)}/${e.substring(2,4)}/${e.substring(4,6)}/${e}.jpg`||"",h=async(e,t,a)=>{let r=await n.Z.create("VIPResource",{upload_ids:[e]}).callGet();if(r.resource_response.data[e]){let n=r.resource_response.data[e],{status:i,signature:l}=n;if("processing"===i||"registered"===i)setTimeout(async()=>{h(e,t,a)},5e3);else if("succeeded"===i){let e=_(l);t(e)}else a()}else a()},f=(e,t,a,r,i)=>{let l=new FormData;return l.append("img",e),n.Z.create("VIPResource",{type:t}).callCreate().then(t=>{if(t.resource_response.data){let{upload_id:n,upload_url:l,upload_parameters:s}=t.resource_response.data,o=new XMLHttpRequest;o.open("POST",l,!0),o.onload=()=>{g(o.status)?(a(100),h(n,r,i)):i()},o.upload.onprogress=e=>{let t=Math.round(100*e.loaded/e.total);a(t)};let d=new FormData;for(let e in s)d.append(e,s[e]);d.append("file",e),o.send(d)}},()=>{i()})},y=e=>new Promise((t,a)=>{f(e,"pinimage",()=>{},e=>{t(e)},e=>{a(e)})}),v=e=>new Promise((t,a)=>{"string"==typeof e?e.startsWith("data")&&y(function(e,t=512){let a=e.split(";"),n=a[0].split(":")[1],r=a[1].split(",")[1],i=atob(r),l=[];for(let e=0;e<i.length;e+=t){let a=i.slice(e,e+t),n=Array(a.length);for(let e=0;e<a.length;e+=1)n[e]=a.charCodeAt(e);let r=new Uint8Array(n);l.push(r)}let s=new Blob(l,{type:n});return s}(e)).then(e=>t(e)):a("Invalid Image")}),k=e=>()=>(0,r.Z)({url:"/v3/register/exists/",data:{email:e}})},641285:(e,t,a)=>{a.d(t,{Z:()=>O});var n,r=a(667294),i=a(702664);a(167912);var l=a(616550),s=a(216167),o=a(798580),d=a(515278),u=a(622888),c=a(190971),p=a(207012),m=a(901855),g=a(140017),_=a(339001),h=a(456299),f=a(498301),y=a(825765),v=a(149722),k=a(86173),P=a(692440),S=a(180338),I=a(821419),b=a(402287),E=a(64819),T=a(767518),U=a(386129),D=a(937310),C=a(785893);function F(e,t,a){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?n:String(n))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}let R=void 0!==n?n:n=a(924633);class Z extends r.PureComponent{constructor(...e){super(...e),F(this,"state",{step:"unsaved"}),F(this,"deletePin",e=>s.Z.create("PinResource",{id:e,client_tracking_params:this.clientTrackingParams}).callDelete()),F(this,"repin",()=>{let{pin:e,target:{board:t,boardSection:a},eventContext:n}=this.props,{clientTrackingParams:r}=this,i=!e?.entityId&&e?.imageUrl?(0,f.Z)(e.imageUrl??"",e.link):"",l=a&&a.id,o={board_id:t.id||"",clientTrackingParams:r,description:e?.description||"",image_base64:e?.imageBase64??"",link:e?.link,image_url:i,is_buyable_pin:!1,is_removable:!!e?.promotedIsRemovable,media_upload_id:e?.mediaUploadId??"",pin_id:e?.entityId||"",section:l,title:e?.title||"",eventContext:n};return s.Z.create("RepinResource",o).callCreate({showError:!1})}),F(this,"handleSave",()=>{let{requireAuth:e,onSave:t,makeCancelablePromise:a,mountAfterActionPlacement:n}=this.props,{step:r}=this.state;if(e){e();return}if("unsaving"===r){this.setState({step:"saving"});return}this.setState({step:"saving"});let i=this.repin().then(({resource_response:{data:e}})=>{this.shouldCompleteSave(e),n("Save",{pin_id:this.props.pin?.entityId,is_promoted:this.props.pin?.isPromoted})});a(i).then(t).catch(({isCanceled:e})=>{if(!e){let{target:{board:e,boardSection:t}}=this.props;u.Z.showError(t?(0,_.nk)(this.props.i18n.bt("Failed to save the Pin to {{sectionName}}", "Failed to save the Pin to {{sectionName}}", "Error message when failed to save to a section within a board", undefined, true),{sectionName:t.title}).join(""):(0,_.nk)(this.props.i18n.bt("Failed to save the Pin to {{boardName}}", "Failed to save the Pin to {{boardName}}", "Error message when failed to save to a board", undefined, true),{boardName:e.name}).join(""))}})}),F(this,"shouldCompleteSave",e=>{let{saveToBoard:t,pin:a,dispatch:n,target:{board:r,boardSection:i}}=this.props,{step:l}=this.state,s=i&&i.id,o={pinId:a?.entityId||"",boardId:r.id,sectionId:s,title:a?.title||""};if("saving"===l){this.props.onPinCreate&&this.props.onPinCreate({boardId:e.board.id,pinId:e.id}),t(r),n((0,E.vX)({feedId:s||r.id,feedType:s?D.Z.BOARD_SECTION_PINS:D.Z.BOARDFEED,itemIds:[a?.entityId??""],itemType:"pin"}));let{imageUrl:l,imageSpec_236x:d}=a??{},u=l||d&&d.url||"";return(i||!r.image_cover_url)&&(r.image_cover_url=u,n((0,I.yT)(r))),n((0,T.a1)({...o,localPinId:e.id,nodeId:a?.__id})),n((0,I.Br)({boardId:r.id,sectionId:i?i.id:void 0,increment:1})),n((0,U.JS)({userId:e.pinner.id,increment:1})),this.setState({step:"saved"}),e}"unsaving"===l&&this.handleUnsave(e.id)}),F(this,"handleUnsave",e=>{let{step:t}=this.state,{savedInfo:a}=this.props.pin??{};if("unsaved"===t)return;if("saving"===t){this.setState({step:"unsaving"});return}let n=a&&a.localPinId||e;n&&(this.setState({step:"unsaving"}),this.deletePin(n).then(()=>this.shouldCompleteUnsave()))}),F(this,"shouldCompleteUnsave",()=>{let{pin:e,target:{board:t,boardSection:a},dispatch:n,onDelete:r,viewerId:i}=this.props,{step:l}=this.state;if("unsaving"===l){if(e?.savedInfo){let l=a?.id;n((0,T.jg)({pinId:e.entityId,nodeId:e.__id})),n((0,I.Br)({boardId:t.id,sectionId:l,increment:-1})),n((0,U.JS)({userId:i,increment:-1})),n((0,I.xQ)(t.id)),n((0,E.EX)({feedId:l||t.id,feedType:l?D.Z.BOARD_SECTION_PINS:D.Z.BOARDFEED,itemIds:[e.entityId??""],itemType:"pin"})),l&&n((0,b.CE)(l)),r&&r()}this.setState({step:"unsaved"})}"saving"===l&&this.handleSave()})}get clientTrackingParams(){let{location:e,pin:t,previousHistory:a}=this.props;return(0,o.Z)({boardUrl:t?.board?.url,location:e,pinId:t?.entityId,pinnerUserName:t?.pinner?.username,previousHistory:a,storyPinDataId:t?.storyPinDataId,trackingParams:t?.trackingParams,trackingParamsMap:(0,h.Z)(t)})||`${t?.trackingParams||""}-0`}render(){let{children:e}=this.props,{step:t}=this.state,{savedInfo:a}=this.props.pin??{};return e({save:this.handleSave,saved:"saved"===t||"saving"===t||!!(a&&a.localPinId),savedInfo:a,unsave:this.handleUnsave})}}function O({pinKey:e,...t}){let{previous:a}=(0,m.Hv)(),{saveToBoard:n}=(0,P.N)(),r=(0,i.useDispatch)(),s=S.W()?.onPinCreate,o=(0,g.ZP)(),u=(0,y.Z)(),_=(0,l.TH)(),h=(0,d.Z)(),f=(0,v.Z)(),I=(0,p.Z)(R,e),b=(0,k.Z)({hasPin:!!I,pinId:I?.entityId,boardLayout:I?.board?.layout,boardUrl:I?.board?.url}),E=(0,c.c)();return(0,C.jsx)(Z,{...t,dispatch:r,i18n:o,location:_,makeCancelablePromise:u,mountAfterActionPlacement:E,onDelete:()=>{b(),t.onDelete?.()},onPinCreate:s,pin:I,previousHistory:a,requireAuth:h,saveToBoard:n,viewerId:f.isAuth?f.id:""})}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/41285.en_AU-5fd8f92f75498dd1.mjs.map